/*!
 *
 *  Web Starter Kit
 *  Copyright 2015 Google Inc. All rights reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *    https://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License
 *
 */
function cartesian2Polar(e,t){var a=e-CenterX,r=t-CenterY;return distance=Math.sqrt(a*a+r*r),radians=Math.atan2(r,a),degr=180*radians/Math.PI+90,polarCoor={distance:distance,degr:degr},polarCoor}function cartesian2Dec(e,t){return radians=(t-90)*(Math.PI/180),t>=0&&t<=180?(tan=Math.tan(radians),x=Math.sqrt(Math.pow(e,2)/(Math.pow(tan,2)+1)),y=x*tan):(tan=Math.tan(-radians),x=-Math.sqrt(Math.pow(e,2)/(Math.pow(tan,2)+1)),y=-x*tan),decCoor={X:x+CenterX,Y:y+CenterY},decCoor}function cartesian2DecForBorder(e,t){var a=t-90;return radians=a*(Math.PI/180),a>=0&&a<=180?(tan=Math.tan(radians),x=Math.sqrt(e*e/(tan*tan+1)),y=x*tan):(tan=Math.tan(-radians),x=Math.sqrt(e*e/(tan*tan+1)),y=x*tan),decCoor={X:x,Y:y},decCoor}function hexInArray(e){var t=e.slice(1).match(/.{2}/g);return t[0]=parseInt(t[0],16),t[1]=parseInt(t[1],16),t[2]=parseInt(t[2],16),t}function hexArrayInRgbString(e){var t="rgb("+e[0]+", "+e[1]+", "+e[2]+")";return t}function changeColorLayers(e,t){var a=hexInArray(e),r=a,n=[],o=0,i=(256-a[0])/t,s=a[1]/(t-1),l=a[2]/(t-1),c=a[0]+i,d=a[1],u=a[2];for(c;c<=256.01;c+=i)r[0]=Math.floor(c),r[1]=Math.floor(d),r[2]=Math.floor(u),n[o]=hexArrayInRgbString(r),d-=s,u-=l,o++;return console.log(n),n}function createSectorNew(e,t,a,r,n,o){var i,e=e,t=t,a=a,r=r,n=n,o=o,s=changeColorLayers(o,n),l=bigRadius/n,c=bigRadius,d="mainArc_"+e,u="main_sector_"+e,h="sector_"+e,g=$("canvas");for(i=1;i<=n;i++)g.drawSlice({layer:!0,mask:!0,groups:[h],fillStyle:s[i-1],x:CenterX,y:CenterY,start:t,end:a,radius:c,strokeStyle:"#f60",strokeWidth:3}).restoreCanvas({layer:!0}),c-=l;g.drawSlice({layer:!0,mask:!0,x:CenterX,y:CenterY,start:t,end:a,name:u,groups:[h],circle_id:r,sector_id:e,radius:bigRadius,numLayers:n,color:o,dblclick:function(e){var t=cartesian2Polar(e.eventX,e.eventY),a=$("#create_label_link").attr("href","/app_dev.php/notes/new/"+e.circle_id+"?radius="+t.distance/bigRadius+"&degr="+t.degr);a.removeClass("btn-primary").addClass("btn-danger"),a.text("Добавить заметку в выбрнный сектор")},click:function(e){$("canvas").drawArc({shadowBlur:40,shadowColor:"white",strokeStyle:"white",name:d,groups:[h],strokeWidth:3,x:CenterX,y:CenterY,radius:bigRadius,start:t,end:a}).restoreCanvas({layer:!0})},mouseout:function(e){$("canvas").setLayer(d,{shadowBlur:0}).drawLayer()}}),g.restoreCanvas({layer:!0})}function createBorderSector(e){var t=cartesian2DecForBorder(bigRadius,e.beginAngle);$("canvas").drawVector({strokeStyle:"white",strokeWidth:4,x:CenterX,y:CenterY,a1:t.X,l1:t.Y})}function borderForSector(e,t,a,r,n){var o=cartesian2Dec(bigRadius,e),i=cartesian2Dec(bigRadius,r+5),s=cartesian2Dec(bigRadius,n-5);$("canvas").drawArc({layer:!0,draggable:!0,sectorLeftId:t,sectorRightId:a,name:"border_"+t+"_"+a,fillStyle:"yellow",x:o.X,y:o.Y,radius:radiusLabel,circlePath:!0,circleRadius:bigRadius,circleCenterX:CenterX,circleCenterY:CenterY,xMin:i.X,yMin:i.Y,xMax:s.X,yMax:s.Y,data:{sectorLeft:t,sectorRight:a},shadowColor:shadowColor,shadowBlur:shadowLabelSize,dragstop:function(e){var r=cartesian2Polar(e.x,e.y),n=$("canvas").getLayer("main_sector_"+e.sectorLeftId),o=$("canvas").getLayer("main_sector_"+e.sectorRightId),i=n.circle_id,s=n.numLayers,l=n.start,c=n.color,d=o.end,u=o.color,h=n.start,g=r.degr,f=n.start,y=o.start,v=(r.degr-l)/(n.end-n.start),p=(d-r.degr)/(o.end-o.start);updateLabelPositionByChangingSector(e,v,p,h,g,f,y),$("canvas").removeLayerGroup("sector_"+t),createSectorNew(t,l,r.degr,i,s,c),$("canvas").removeLayerGroup("sector_"+a),createSectorNew(a,r.degr,d,i,s,u),setHightMoveLayerToLayer()},drag:function(e){var t=cartesian2Polar(e.x,e.y);$("canvas").drawVector({strokeStyle:"white",strokeWidth:4,x:CenterX,y:CenterY,a1:t.degr,l1:t.distance})},mouseover:function(t){$("canvas").drawVector({strokeStyle:"white",strokeWidth:4,x:CenterX,y:CenterY,a1:e,l1:bigRadius})},mouseout:function(e){},dblclick:function(e){}})}function rayAndCircleByLabel(e,t){var a=cartesian2Polar(e.x,e.y),r=cartesian2Dec(500,a.degr);$("canvas").drawArc({layer:!0,strokeStyle:colorRayAndCircleByLabel,strokeWidth:3,name:"circleByLabel"+t,groups:["circleByLabel"],x:CenterX,y:CenterY,radius:a.distance}),$("canvas").drawLine({layer:!0,strokeWidth:3,name:"lineByLabel"+t,groups:["lineByLabel"],strokeStyle:colorRayAndCircleByLabel,x1:CenterX,y1:CenterY,x2:r.X,y2:r.Y})}function createNamePopUpLabel(e,t,a,r){var n=30,o=150;$("canvas").drawRect({layer:!0,fillStyle:"white",strokeStyle:"#c33",strokeWidth:2,name:"nameLabelPopup"+e,groups:["nameLabelPopup"],x:t+o/2,y:a-n/2-10,width:o,height:n,cornerRadius:10}),$("canvas").drawText({layer:!0,name:"nameLabelPopupText"+e,groups:["nameLabelPopupText"],fillStyle:"black",strokeWidth:2,x:t+o/2,y:a-n/2-10,fontSize:"10pt",fontFamily:"Verdana, sans-serif",maxWidth:o,text:r})}function createLabel(e){var t=cartesian2Dec(e.radius*bigRadius,e.degr);$("canvas").drawArc({layer:!0,draggable:!0,groups:["note_labels"],name:"myLabel"+e.id,fillStyle:colorLabel,x:t.X,y:t.Y,radius:radiusLabel,data:{id:e.id,name:e.name,circleId:e.circleId},label_radius:e.radius,label_angle:e.degr,label_id:e.id,shadowColor:shadowColor,shadowBlur:shadowLabelSize,dragstop:function(e){var t=cartesian2Polar(e.x,e.y);cartesian2Dec(t.distance,t.degr);e.label_radius=t.distance/bigRadius,e.label_angle=t.degr,updateCoordinateLabel(e.data.circleId,e.data.id,t.distance/bigRadius,t.degr),delRayNamePopUpAndCircleByLabel(e.data.id)},drag:function(e){delRayNamePopUpAndCircleByLabel(e.data.id),rayAndCircleByLabel(e,e.data.id)},mouseover:function(e){var t=$("canvas").getLayer(e.name);t.fillStyle=colorSelectLabel,delRayNamePopUpAndCircleAllLabels(),rayAndCircleByLabel(e,e.data.id),setLinkLabelsByRadiusAndAngle(e.label_radius,e.label_angle,e.label_id),createNamePopUpLabel(e.data.id,e.x,e.y,e.data.name)},mouseout:function(e){var t=$("canvas").getLayer(e.name);t.fillStyle=colorLabel,delRayNamePopUpAndCircleByLabel(e.data.id),removeLinkLabelsByRadiusAndAngle(e.label_radius,e.label_angle,e.label_id)},dblclick:function(e){$("#pop_label_link").css("display","block").attr("href","/app_dev.php/notes/list/"+e.data.circleId+"/"+e.data.id+"/")}})}function setHightMoveLayerToLayer(){function e(e,t,a){$("canvas").moveLayer(e.name,100)}var t=$("canvas").getLayers(function(e){return e.draggable===!0});t.forEach(e)}function setLinkLabelsByRadiusAndAngle(e,t,a){function r(e,t,r){e.id!==a&&(e.label_angle>s&&e.label_angle<l||e.label_radius>o&&e.label_radius<i)&&(createNamePopUpLabel(e.label_id,e.x,e.y,e.data.name),e.fillStyle=colorSelectLabel)}var n=$("canvas").getLayerGroup("note_labels"),o=e-.05,i=e+.05,s=t-10,l=t+10;n.forEach(r)}function removeLinkLabelsByRadiusAndAngle(e,t,a){function r(e,t,r){e.label_id!==a&&(e.label_angle>s&&e.label_angle<l||e.label_radius>o&&e.label_radius<i)&&(e.fillStyle=colorLabel,delNamePopUpByLabel(e.label_id))}var n=$("canvas").getLayerGroup("note_labels"),o=e-.03,i=e+.03,s=t-10,l=t+10;n.forEach(r)}function updateLabelPositionByChangingSector(e,t,a,r,n,o,i){function s(e,s,d){if(e.label_angle>l.start&&e.label_angle<l.end){var u=(e.label_angle-o)*t+r,h=cartesian2Dec(e.label_radius*bigRadius,u);e.x=h.X,e.y=h.Y,console.log(e.name,e.label_angle,u,l,r,n,o,i,t),e.label_angle=u}else if(e.label_angle>c.start&&e.label_angle<c.end){var u=(e.label_angle-i)*a+n,h=cartesian2Dec(e.label_radius*bigRadius,u);e.x=h.X,e.y=h.Y,e.label_angle=u}}var l=$("canvas").getLayer("main_sector_"+e.sectorLeftId),c=$("canvas").getLayer("main_sector_"+e.sectorRightId),d=$("canvas").getLayerGroup("note_labels");d.forEach(s)}function updateCoordinateLabel(e,t,a,r){$.post("/app_dev.php/circle/editLabelAjax",{circleId:e,labelId:t,radius:a,angle:r}).done(function(e){console.log(e)})}function delRayNamePopUpAndCircleByLabel(e){$("canvas").removeLayer("circleByLabel"+e),$("canvas").removeLayer("lineByLabel"+e),$("canvas").removeLayer("nameLabelPopup"+e),$("canvas").removeLayer("nameLabelPopupText"+e)}function delNamePopUpByLabel(e){$("canvas").removeLayer("nameLabelPopup"+e),$("canvas").removeLayer("nameLabelPopupText"+e)}function delRayNamePopUpAndCircleAllLabels(){$("canvas").removeLayerGroup("circleByLabel"),$("canvas").removeLayerGroup("lineByLabel"),$("canvas").removeLayerGroup("nameLabelPopup"),$("canvas").removeLayerGroup("nameLabelPopupText")}function addTagForm(e,t){var a=e.data("prototype"),r=e.data("index"),n=a.replace(/__name__/g,r);e.data("index",r+1);var o=$(n);o.append('<button class="remove-tag btn btn-danger"><i class="fa fa-remove fa-lg"></i></button>'),t.before(o),$(".remove-tag").click(function(e){return e.preventDefault(),$(this).parent().remove(),!1})}function addTagFormDeleteLink(e){var t=$('<a href="#">delete this tag</a>');e.append(t),t.on("click",function(t){t.preventDefault(),e.remove()})}!function(){"use strict";var e=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));"serviceWorker"in navigator&&("https:"===window.location.protocol||e)&&navigator.serviceWorker.register("service-worker.js").then(function(e){e.onupdatefound=function(){if(navigator.serviceWorker.controller){var t=e.installing;t.onstatechange=function(){switch(t.state){case"installed":break;case"redundant":throw new Error("The installing service worker became redundant.")}}}}})["catch"](function(e){console.error("Error during service worker registration:",e)})}(),/**
 * @license jCanvas v20.1.4
 * Copyright 2017 Caleb Evans
 * Released under the MIT license
 */
function(e,t,a){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=function(e,t){return a(e,t)}:a(e,t)}("undefined"!=typeof window?window.jQuery:{},"undefined"!=typeof window?window:this,function(e,t){"use strict";function a(e){var t,a=this;for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t]);return a}function r(){me(this,r.baseDefaults)}function n(e){return"string"===xe(e)}function o(e){return!isNaN(ve(e))&&!isNaN(pe(e))}function i(e){return e&&e.getContext?e.getContext("2d"):null}function s(e){var t,a,r;for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r=e[t],a=xe(r),"string"===a&&o(r)&&"text"!==t&&(e[t]=pe(r)));void 0!==e.text&&(e.text=String(e.text))}function l(e){return e=me({},e),e.masks=e.masks.slice(0),e}function c(e,t){var a;e.save(),a=l(t.transforms),t.savedTransforms.push(a)}function d(e,t){0===t.savedTransforms.length?t.transforms=l($e):(e.restore(),t.transforms=t.savedTransforms.pop())}function u(e,t,a,r){a[r]&&(be(a[r])?t[r]=a[r].call(e,a):t[r]=a[r])}function h(e,t,a){u(e,t,a,"fillStyle"),u(e,t,a,"strokeStyle"),t.lineWidth=a.strokeWidth,a.rounded?t.lineCap=t.lineJoin="round":(t.lineCap=a.strokeCap,t.lineJoin=a.strokeJoin,t.miterLimit=a.miterLimit),a.strokeDash||(a.strokeDash=[]),t.setLineDash&&t.setLineDash(a.strokeDash),t.webkitLineDash=a.strokeDash,t.lineDashOffset=t.webkitLineDashOffset=t.mozDashOffset=a.strokeDashOffset,t.shadowOffsetX=a.shadowX,t.shadowOffsetY=a.shadowY,t.shadowBlur=a.shadowBlur,t.shadowColor=a.shadowColor,t.globalAlpha=a.opacity,t.globalCompositeOperation=a.compositing,a.imageSmoothing&&(t.imageSmoothingEnabled=a.imageSmoothing)}function g(e,t,a){a.mask&&(a.autosave&&c(e,t),e.clip(),t.transforms.masks.push(a._args))}function f(e,t){t._transformed&&e.restore()}function y(e,t,a){var r;a.closed&&t.closePath(),a.shadowStroke&&0!==a.strokeWidth?(t.stroke(),t.fill(),t.shadowColor="transparent",t.shadowBlur=0,t.stroke()):(t.fill(),"transparent"!==a.fillStyle&&(t.shadowColor="transparent"),0!==a.strokeWidth&&t.stroke()),a.closed||t.closePath(),f(t,a),a.mask&&(r=p(e),g(t,r,a))}function v(e,t,a,r,n){a._toRad=a.inDegrees?_e/180:1,a._transformed=!0,t.save(),a.fromCenter||a._centered||void 0===r||(void 0===n&&(n=r),a.x+=r/2,a.y+=n/2,a._centered=!0),a.rotate&&N(t,a,null),1===a.scale&&1===a.scaleX&&1===a.scaleY||F(t,a,null),(a.translate||a.translateX||a.translateY)&&U(t,a,null)}function p(t){var a,r=Ye.dataCache;return r._canvas===t&&r._data?a=r._data:(a=e.data(t,"jCanvas"),a||(a={canvas:t,layers:[],layer:{names:{},groups:{}},eventHooks:{},intersecting:[],lastIntersected:null,cursor:e(t).css("cursor"),drag:{layer:null,dragging:!1},event:{type:null,x:null,y:null},events:{},transforms:l($e),savedTransforms:[],animating:!1,animated:null,pixelRatio:1,scaled:!1,redrawOnMousemove:!1},e.data(t,"jCanvas",a)),r._canvas=t,r._data=a),a}function m(e,t,a){var r;for(r in Be.events)Object.prototype.hasOwnProperty.call(Be.events,r)&&(a[r]||a.cursors&&a.cursors[r])&&x(e,t,a,r);t.events.mouseout||(e.bind("mouseout.jCanvas",function(){var a,r=t.drag.layer;for(r&&(t.drag={},X(e,t,r,"dragcancel")),a=0;a<t.layers.length;a+=1)r=t.layers[a],r._hovered&&e.triggerLayerEvent(t.layers[a],"mouseout");e.drawLayers()}),t.events.mouseout=!0)}function w(e,t,a,r){Be.events[r](e,t),a._event=!0}function x(e,t,a,r){w(e,t,a,r),"mouseover"!==r&&"mouseout"!==r&&"mousemove"!==r||(t.redrawOnMousemove=!0)}function b(e,t,a){var r,n,o;if(a.draggable||a.cursors){for(r=["mousedown","mousemove","mouseup"],o=0;o<r.length;o+=1)n=r[o],w(e,t,a,n);a._event=!0}}function L(e,t,a,r){var o=t.layer.names;r?void 0!==r.name&&n(a.name)&&a.name!==r.name&&delete o[a.name]:r=a,n(r.name)&&(o[r.name]=a)}function _(e,t,a,r){var n,o,i,s,l,c=t.layer.groups;if(r){if(void 0!==r.groups&&null!==a.groups)for(i=0;i<a.groups.length;i+=1)if(o=a.groups[i],n=c[o]){for(l=0;l<n.length;l+=1)if(n[l]===a){s=l,n.splice(l,1);break}0===n.length&&delete c[o]}}else r=a;if(void 0!==r.groups&&null!==r.groups)for(i=0;i<r.groups.length;i+=1)o=r.groups[i],n=c[o],n||(n=c[o]=[],n.name=o),void 0===s&&(s=n.length),n.splice(s,0,a)}function C(e){var t,a,r,n;for(t=null,a=e.intersecting.length-1;a>=0;a-=1)if(t=e.intersecting[a],t._masks){for(n=t._masks.length-1;n>=0;n-=1)if(r=t._masks[n],!r.intersects){t.intersects=!1;break}if(t.intersects&&!t.intangible)break}return t&&t.intangible&&(t=null),t}function k(e,t,a,r){a&&a.visible&&a._method&&(r?a._next=r:a._next=null,a._method&&a._method.call(e,a))}function R(e,t,a){var r,n,o,i,s,l,c,d,u,h;if(i=t.drag,n=i.layer,s=n&&n.dragGroups||[],r=t.layers,"mousemove"===a||"touchmove"===a){if(i.dragging||(i.dragging=!0,n.dragging=!0,n.bringToFront&&(r.splice(n.index,1),n.index=r.push(n)),n._startX=n.x,n._startY=n.y,n._endX=n._eventX,n._endY=n._eventY,X(e,t,n,"dragstart")),i.dragging){if(u=n._eventX-(n._endX-n._startX),h=n._eventY-(n._endY-n._startY),n.updateDragX&&(u=n.updateDragX.call(e[0],n,u)),n.updateDragY&&(h=n.updateDragY.call(e[0],n,h)),n.dx=u-n.x,n.dy=h-n.y,"y"!==n.restrictDragToAxis&&(n.x=u),"x"!==n.restrictDragToAxis&&(n.y=h),n.circlePath===!0){var g=n.circleCenterX,f=n.circleCenterY,y=n.circleRadius,v=n.x-g,p=n.y-f,m=p/v;if(v<0)var w=-ye.sqrt(ye.pow(y,2)/(1+ye.pow(m,2)));else var w=ye.sqrt(ye.pow(y,2)/(1+ye.pow(m,2)));var x=w*m,b=n.xMin,L=n.yMin,_=n.xMax,C=n.yMax,k=u,R=h,S=(ye.pow(b,2)+ye.pow(L,2))*(_*R-C*k)-(ye.pow(_,2)+ye.pow(C,2))*(b*R-L*k)+(ye.pow(k,2)+ye.pow(R,2))*(b*C-L*_);if(S<=0){var P=ye.abs(n.xMin-u)+ye.abs(n.yMin-h),T=ye.abs(n.xMax-u)+ye.abs(n.yMax-h);P<T?(w=n.xMin-g,x=n.yMin-f):(w=n.xMax-g,x=n.yMax-f)}var u=w+g,h=x+f;n.x=u,n.y=h}for(X(e,t,n,"drag"),d=0;d<s.length;d+=1)if(c=s[d],l=t.layer.groups[c],n.groups&&l)for(o=0;o<l.length;o+=1)l[o]!==n&&("y"!==n.restrictDragToAxis&&"y"!==l[o].restrictDragToAxis&&(l[o].x+=n.dx),"x"!==n.restrictDragToAxis&&"x"!==l[o].restrictDragToAxis&&(l[o].y+=n.dy))}}else"mouseup"!==a&&"touchend"!==a||(i.dragging&&(n.dragging=!1,i.dragging=!1,t.redrawOnMousemove=t.originalRedrawOnMousemove,X(e,t,n,"dragstop")),t.drag={})}function S(t,a,r){var n;a.cursors&&(n=a.cursors[r]),e.inArray(n,De.cursors)!==-1&&(n=De.prefix+n),n&&t.css({cursor:n})}function P(e,t){e.css({cursor:t.cursor})}function T(e,t,a,r,n){r[a]&&t._running&&!t._running[a]&&(t._running[a]=!0,r[a].call(e[0],t,n),t._running[a]=!1)}function A(t,a){return!(t.disableEvents||t.intangible&&e.inArray(a,Oe)!==-1)}function X(e,t,a,r,n){A(a,r)&&("mouseout"!==r&&S(e,a,r),T(e,a,r,a,n),T(e,a,r,t.eventHooks,n),T(e,a,r,Be.eventHooks,n))}function Y(t,r,o,i){var l,c,d,u=r._layer?o:r;return r._args=o,(r.draggable||r.dragGroups)&&(r.layer=!0,r.draggable=!0),r._method||(i?r._method=i:r.method?r._method=e.fn[r.method]:r.type&&(r._method=e.fn[Xe.drawings[r.type]])),r.layer&&!r._layer?(l=e(t),c=p(t),d=c.layers,(null===u.name||n(u.name)&&void 0===c.layer.names[u.name])&&(s(r),u=new a(r),u.canvas=t,u.layer=!0,u._layer=!0,u._running={},null!==u.data?u.data=me({},u.data):u.data={},null!==u.groups?u.groups=u.groups.slice(0):u.groups=[],L(l,c,u),_(l,c,u),m(l,c,u),b(l,c,u),r._event=u._event,u._method===e.fn.drawText&&l.measureText(u),null===u.index&&(u.index=d.length),d.splice(u.index,0,u),r._args=u,X(l,c,u,"add"))):r.layer||s(r),u}function $(e){var t,a;for(a=0;a<De.props.length;a+=1)t=De.props[a],e[t]=e["_"+t]}function D(e,t){var a,r;for(r=0;r<De.props.length;r+=1)a=De.props[r],void 0!==e[a]&&(e["_"+a]=e[a],De.propsObj[a]=!0,t&&delete e[a])}function O(e,t,a){var r,n,o,i;for(r in a)if(Object.prototype.hasOwnProperty.call(a,r)&&(n=a[r],be(n)&&(a[r]=n.call(e,t,r)),"object"===xe(n)&&Le(n))){for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i=n[o],void 0!==t[r]&&(t[r+"."+o]=t[r][o],a[r+"."+o]=i));delete a[r]}return a}function B(e){var t;for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&t.indexOf(".")!==-1&&delete e[t]}function M(t){var a,r,n=[],o=1;return"transparent"===t?t="rgba(0, 0, 0, 0)":t.match(/^([a-z]+|#[0-9a-f]+)$/gi)&&(r=ue.head,a=r.style.color,r.style.color=t,t=e.css(r,"color"),r.style.color=a),t.match(/^rgb/gi)&&(n=t.match(/(\d+(\.\d+)?)/gi),t.match(/%/gi)&&(o=2.55),n[0]*=o,n[1]*=o,n[2]*=o,void 0!==n[3]?n[3]=pe(n[3]):n[3]=1),n}function I(e){var t,a=3;for("array"!==xe(e.start)&&(e.start=M(e.start),e.end=M(e.end)),e.now=[],1===e.start[3]&&1===e.end[3]||(a=4),t=0;t<a;t+=1)e.now[t]=e.start[t]+(e.end[t]-e.start[t])*e.pos,t<3&&(e.now[t]=Ce(e.now[t]));1!==e.start[3]||1!==e.end[3]?e.now="rgba("+e.now.join(",")+")":(e.now.slice(0,3),e.now="rgb("+e.now.join(",")+")"),e.elem.nodeName?e.elem.style[e.prop]=e.now:e.elem[e.prop]=e.now}function W(t){var a;for(a=0;a<t.length;a+=1)e.fx.step[t[a]]=I}function j(e){return Xe.touchEvents[e]&&(e=Xe.touchEvents[e]),e}function z(e){return Xe.mouseEvents[e]&&(e=Xe.mouseEvents[e]),e}function G(e){Be.events[e]=function(t,a){function r(e){i.x=e.offsetX,i.y=e.offsetY,i.type=n,i.event=e,("mousemove"!==e.type||a.redrawOnMousemove||a.drag.dragging)&&t.drawLayers({resetFire:!0}),e.preventDefault()}var n,o,i;i=a.event,n="mouseover"===e||"mouseout"===e?"mousemove":e,o=j(n),a.events[n]||(o!==n?t.bind(n+".jCanvas "+o+".jCanvas",r):t.bind(n+".jCanvas",r),a.events[n]=!0)}}function H(e){var t;for(t=0;t<e.length;t+=1)G(e[t])}function E(e,t,a){var r,n,o,i,s,l,c,d;r=a._args,r&&(n=p(e),o=n.event,null!==o.x&&null!==o.y&&(l=o.x*n.pixelRatio,c=o.y*n.pixelRatio,i=t.isPointInPath(l,c)||t.isPointInStroke&&t.isPointInStroke(l,c)),s=n.transforms,r.eventX=o.x,r.eventY=o.y,r.event=o.event,d=n.transforms.rotate,l=r.eventX,c=r.eventY,0!==d?(r._eventX=l*Se(-d)-c*Re(-d),r._eventY=c*Se(-d)+l*Re(-d)):(r._eventX=l,r._eventY=c),r._eventX/=s.scaleX,r._eventY/=s.scaleY,i&&n.intersecting.push(r),r.intersects=Boolean(i))}function N(e,t,a){t._toRad=t.inDegrees?_e/180:1,e.translate(t.x,t.y),e.rotate(t.rotate*t._toRad),e.translate(-t.x,-t.y),a&&(a.rotate+=t.rotate*t._toRad)}function F(e,t,a){1!==t.scale&&(t.scaleX=t.scaleY=t.scale),e.translate(t.x,t.y),e.scale(t.scaleX,t.scaleY),e.translate(-t.x,-t.y),a&&(a.scaleX*=t.scaleX,a.scaleY*=t.scaleY)}function U(e,t,a){t.translate&&(t.translateX=t.translateY=t.translate),e.translate(t.translateX,t.translateY),a&&(a.translateX+=t.translateX,a.translateY+=t.translateY)}function q(e){for(;e<0;)e+=2*_e;return e}function V(e,t){return e.x+e.radius*Se(t)}function J(e,t){return e.y+e.radius*Re(t)}function Q(e,t,a,r){var n,o,i,s,l,c,d,u,h,g,f;a===r?(h=0,g=0):(h=a.x,g=a.y),r.inDegrees||360!==r.end||(r.end=2*_e),r.start*=a._toRad,r.end*=a._toRad,r.start-=_e/2,r.end-=_e/2,f=_e/180,r.ccw&&(f*=-1),n=V(r,r.start+f),o=J(r,r.start+f),i=V(r,r.start),s=J(r,r.start),Z(e,t,a,r,n,o,i,s),t.arc(r.x+h,r.y+g,r.radius,r.start,r.end,r.ccw),l=V(r,r.end+f),c=J(r,r.end+f),d=V(r,r.end),u=J(r,r.end),ee(e,t,a,r,d,u,l,c)}function K(e,t,a,r,n,o,i,s){var l,c,d,u,h,g,f;r.arrowRadius&&!a.closed&&(f=Pe(s-o,i-n),f-=_e,h=a.strokeWidth*Se(f),g=a.strokeWidth*Re(f),l=i+r.arrowRadius*Se(f+r.arrowAngle/2),c=s+r.arrowRadius*Re(f+r.arrowAngle/2),d=i+r.arrowRadius*Se(f-r.arrowAngle/2),u=s+r.arrowRadius*Re(f-r.arrowAngle/2),t.moveTo(l-h,c-g),t.lineTo(i-h,s-g),t.lineTo(d-h,u-g),t.moveTo(i-h,s-g),t.lineTo(i+h,s+g),t.moveTo(i,s))}function Z(e,t,a,r,n,o,i,s){r._arrowAngleConverted||(r.arrowAngle*=a._toRad,r._arrowAngleConverted=!0),r.startArrow&&K(e,t,a,r,n,o,i,s)}function ee(e,t,a,r,n,o,i,s){r._arrowAngleConverted||(r.arrowAngle*=a._toRad,r._arrowAngleConverted=!0),r.endArrow&&K(e,t,a,r,n,o,i,s)}function te(e,t,a,r){var n,o,i;for(n=2,Z(e,t,a,r,r.x2+a.x,r.y2+a.y,r.x1+a.x,r.y1+a.y),void 0!==r.x1&&void 0!==r.y1&&t.moveTo(r.x1+a.x,r.y1+a.y);;){if(o=r["x"+n],i=r["y"+n],void 0===o||void 0===i)break;t.lineTo(o+a.x,i+a.y),n+=1}n-=1,ee(e,t,a,r,r["x"+(n-1)]+a.x,r["y"+(n-1)]+a.y,r["x"+n]+a.x,r["y"+n]+a.y)}function ae(e,t,a,r){var n,o,i,s,l;for(n=2,Z(e,t,a,r,r.cx1+a.x,r.cy1+a.y,r.x1+a.x,r.y1+a.y),void 0!==r.x1&&void 0!==r.y1&&t.moveTo(r.x1+a.x,r.y1+a.y);;){if(o=r["x"+n],i=r["y"+n],s=r["cx"+(n-1)],l=r["cy"+(n-1)],void 0===o||void 0===i||void 0===s||void 0===l)break;t.quadraticCurveTo(s+a.x,l+a.y,o+a.x,i+a.y),n+=1}n-=1,ee(e,t,a,r,r["cx"+(n-1)]+a.x,r["cy"+(n-1)]+a.y,r["x"+n]+a.x,r["y"+n]+a.y)}function re(e,t,a,r){var n,o,i,s,l,c,d,u;for(n=2,o=1,Z(e,t,a,r,r.cx1+a.x,r.cy1+a.y,r.x1+a.x,r.y1+a.y),void 0!==r.x1&&void 0!==r.y1&&t.moveTo(r.x1+a.x,r.y1+a.y);;){if(i=r["x"+n],s=r["y"+n],l=r["cx"+o],c=r["cy"+o],d=r["cx"+(o+1)],u=r["cy"+(o+1)],void 0===i||void 0===s||void 0===l||void 0===c||void 0===d||void 0===u)break;t.bezierCurveTo(l+a.x,c+a.y,d+a.x,u+a.y,i+a.x,s+a.y),n+=1,o+=2}n-=1,o-=2,ee(e,t,a,r,r["cx"+(o+1)]+a.x,r["cy"+(o+1)]+a.y,r["x"+n]+a.x,r["y"+n]+a.y)}function ne(e,t,a){return t*=e._toRad,t-=_e/2,a*Se(t)}function oe(e,t,a){return t*=e._toRad,t-=_e/2,a*Re(t)}function ie(e,t,a,r){var n,o,i,s,l,c,d,u,h,g,f;for(a===r?(s=0,l=0):(s=a.x,l=a.y),n=1,c=u=g=r.x+s,d=h=f=r.y+l,Z(e,t,a,r,c+ne(a,r.a1,r.l1),d+oe(a,r.a1,r.l1),c,d),void 0!==r.x&&void 0!==r.y&&t.moveTo(c,d);;){if(o=r["a"+n],i=r["l"+n],void 0===o||void 0===i)break;u=g,h=f,g+=ne(a,o,i),f+=oe(a,o,i),t.lineTo(g,f),n+=1}ee(e,t,a,r,u,h,g,f)}function se(e,t,a){isNaN(ve(a.fontSize))||(a.fontSize+="px"),t.font=a.fontStyle+" "+a.fontSize+" "+a.fontFamily}function le(t,a,r,n){var o,i,s,l=Ye.propCache;if(l.text===r.text&&l.fontStyle===r.fontStyle&&l.fontSize===r.fontSize&&l.fontFamily===r.fontFamily&&l.maxWidth===r.maxWidth&&l.lineHeight===r.lineHeight)r.width=l.width,r.height=l.height;else{for(r.width=a.measureText(n[0]).width,s=1;s<n.length;s+=1)i=a.measureText(n[s]).width,i>r.width&&(r.width=i);o=t.style.fontSize,t.style.fontSize=r.fontSize,r.height=pe(e.css(t,"fontSize"))*n.length*r.lineHeight,t.style.fontSize=o}}function ce(e,t){var a,r,n,o,i,s,l=String(t.text),c=t.maxWidth,d=l.split("\n"),u=[];for(n=0;n<d.length;n+=1){if(o=d[n],i=o.split(" "),a=[],r="",1===i.length||e.measureText(o).width<c)a=[o];else{for(s=0;s<i.length;s+=1)e.measureText(r+i[s]).width>c&&(""!==r&&a.push(r),r=""),r+=i[s],s!==i.length-1&&(r+=" ");a.push(r)}u=u.concat(a.join("\n").replace(/((\n))|($)/gi,"$2").split("\n"))}return u}var de,ue=t.document,he=t.Image,ge=t.Array,fe=t.getComputedStyle,ye=t.Math,ve=t.Number,pe=t.parseFloat,me=e.extend,we=e.inArray,xe=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},be=e.isFunction,Le=e.isPlainObject,_e=ye.PI,Ce=ye.round,ke=ye.abs,Re=ye.sin,Se=ye.cos,Pe=ye.atan2,Te=ge.prototype.slice,Ae=e.event.fix,Xe={},Ye={dataCache:{},propCache:{},imageCache:{}},$e={rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:[]},De={},Oe=["mousedown","mousemove","mouseup","mouseover","mouseout","touchstart","touchmove","touchend"],Be={events:{},eventHooks:{},future:{}};r.baseDefaults={align:"center",arrowAngle:90,arrowRadius:0,autosave:!0,baseline:"middle",bringToFront:!1,ccw:!1,closed:!1,compositing:"source-over",concavity:0,cornerRadius:0,count:1,cropFromCenter:!0,crossOrigin:null,cursors:null,disableEvents:!1,draggable:!1,dragGroups:null,groups:null,data:null,dx:null,dy:null,end:360,eventX:null,eventY:null,fillStyle:"transparent",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:!0,height:null,imageSmoothing:!0,inDegrees:!0,intangible:!1,index:null,letterSpacing:null,lineHeight:1,layer:!1,mask:!1,maxWidth:null,miterLimit:10,name:null,opacity:1,r1:null,r2:null,radius:0,repeat:"repeat",respectAlign:!1,restrictDragToAxis:null,rotate:0,rounded:!1,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowStroke:!1,shadowX:0,shadowY:0,sHeight:null,sides:0,source:"",spread:0,start:0,strokeCap:"butt",strokeDash:null,strokeDashOffset:0,strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:null,sx:null,sy:null,text:"",translate:0,translateX:0,translateY:0,type:null,visible:!0,width:null,x:0,y:0},de=new r,a.prototype=de,Be.extend=function(t){return t.name&&(t.props&&me(de,t.props),e.fn[t.name]=function r(e){var n,o,s,l,c=this;for(o=0;o<c.length;o+=1)n=c[o],s=i(n),s&&(l=new a(e),Y(n,l,e,r),h(n,s,l),t.fn.call(n,s,l));return c},t.type&&(Xe.drawings[t.type]=t.name)),e.fn[t.name]},e.fn.getEventHooks=function(){var e,t,a=this,r={};return 0!==a.length&&(e=a[0],t=p(e),r=t.eventHooks),r},e.fn.setEventHooks=function(e){var t,a,r=this;for(t=0;t<r.length;t+=1)a=p(r[t]),me(a.eventHooks,e);return r},e.fn.getLayers=function(e){var t,a,r,n,o,i=this,s=[];if(0!==i.length)if(t=i[0],a=p(t),r=a.layers,be(e))for(o=0;o<r.length;o+=1)n=r[o],e.call(t,n)&&s.push(n);else s=r;return s},e.fn.getLayer=function(e){var t,a,r,o,i,s,l=this;if(0!==l.length)if(t=l[0],a=p(t),r=a.layers,s=xe(e),e&&e.layer)o=e;else if("number"===s)e<0&&(e=r.length+e),o=r[e];else if("regexp"===s){for(i=0;i<r.length;i+=1)if(n(r[i].name)&&r[i].name.match(e)){o=r[i];break}}else o=a.layer.names[e];return o},e.fn.getLayerGroup=function(e){var t,a,r,n,o,i=this,s=xe(e);if(0!==i.length)if(t=i[0],"array"===s)o=e;else if("regexp"===s){a=p(t),r=a.layer.groups;for(n in r)if(n.match(e)){o=r[n];break}}else a=p(t),o=a.layer.groups[e];return o},e.fn.getLayerIndex=function(e){var t=this,a=t.getLayers(),r=t.getLayer(e);return we(r,a)},e.fn.setLayer=function(t,a){var r,n,i,l,c,d,u,h=this;for(n=0;n<h.length;n+=1)if(r=e(h[n]),i=p(h[n]),l=e(h[n]).getLayer(t)){L(r,i,l,a),_(r,i,l,a),s(a);for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(d=a[c],u=xe(d),"object"===u&&Le(d)?(l[c]=me({},d),s(l[c])):"array"===u?l[c]=d.slice(0):"string"===u?0===d.indexOf("+=")?l[c]+=pe(d.substr(2)):0===d.indexOf("-=")?l[c]-=pe(d.substr(2)):!isNaN(d)&&o(d)&&"text"!==c?l[c]=pe(d):l[c]=d:l[c]=d);m(r,i,l),b(r,i,l),e.isEmptyObject(a)===!1&&X(r,i,l,"change",a)}return h},e.fn.setLayers=function(t,a){var r,n,o,i,s=this;for(n=0;n<s.length;n+=1)for(r=e(s[n]),o=r.getLayers(a),i=0;i<o.length;i+=1)r.setLayer(o[i],t);return s},e.fn.setLayerGroup=function(t,a){var r,n,o,i,s=this;for(n=0;n<s.length;n+=1)if(r=e(s[n]),o=r.getLayerGroup(t))for(i=0;i<o.length;i+=1)r.setLayer(o[i],a);return s},e.fn.moveLayer=function(t,a){var r,n,o,i,s,l=this;for(n=0;n<l.length;n+=1)r=e(l[n]),o=p(l[n]),i=o.layers,s=r.getLayer(t),s&&(s.index=we(s,i),i.splice(s.index,1),i.splice(a,0,s),a<0&&(a=i.length+a),s.index=a,X(r,o,s,"move"));return l},e.fn.removeLayer=function(t){var a,r,n,o,i,s=this;for(r=0;r<s.length;r+=1)a=e(s[r]),n=p(s[r]),o=a.getLayers(),i=a.getLayer(t),i&&(i.index=we(i,o),o.splice(i.index,1),delete i._layer,L(a,n,i,{name:null}),_(a,n,i,{groups:null}),X(a,n,i,"remove"));return s},e.fn.removeLayers=function(t){var a,r,n,o,i,s,l=this;for(r=0;r<l.length;r+=1){for(a=e(l[r]),n=p(l[r]),o=a.getLayers(t),s=0;s<o.length;s+=1)i=o[s],a.removeLayer(i),s-=1;n.layer.names={},n.layer.groups={}}return l},e.fn.removeLayerGroup=function(t){var a,r,n,o,i=this;if(void 0!==t)for(r=0;r<i.length;r+=1)if(a=e(i[r]),n=a.getLayerGroup(t))for(n=n.slice(0),o=0;o<n.length;o+=1)a.removeLayer(n[o]);return i},e.fn.addLayerToGroup=function(t,a){var r,n,o,i=this,s=[a];for(n=0;n<i.length;n+=1)r=e(i[n]),o=r.getLayer(t),o.groups&&(s=o.groups.slice(0),we(a,o.groups)===-1&&s.push(a)),r.setLayer(o,{groups:s});return i},e.fn.removeLayerFromGroup=function(t,a){var r,n,o,i,s=this,l=[];for(n=0;n<s.length;n+=1)r=e(s[n]),o=r.getLayer(t),o.groups&&(i=we(a,o.groups),i!==-1&&(l=o.groups.slice(0),l.splice(i,1),r.setLayer(o,{groups:l})));return s},De.cursors=["grab","grabbing","zoom-in","zoom-out"],De.prefix=function(){var e=fe(ue.documentElement,""),t=(Te.call(e).join("").match(/-(moz|webkit|ms)-/)||""===e.OLink&&["","o"])[1];return"-"+t+"-"}(),e.fn.triggerLayerEvent=function(t,a){var r,n,o,i=this;for(n=0;n<i.length;n+=1)r=e(i[n]),o=p(i[n]),t=r.getLayer(t),t&&X(r,o,t,a);return i},e.fn.drawLayer=function(t){var a,r,n,o,s=this;for(a=0;a<s.length;a+=1)n=e(s[a]),r=i(s[a]),r&&(o=n.getLayer(t),k(n,r,o));return s},e.fn.drawLayers=function(t){var a,r,n,o,s,c,d,u,h,g,f,y,v,m=this,w=t||{};for(u=w.index,u||(u=0),r=0;r<m.length;r+=1)if(a=e(m[r]),n=i(m[r])){for(g=p(m[r]),w.clear!==!1&&a.clearCanvas(),o=g.layers,d=u;d<o.length;d+=1)if(s=o[d],s.index=d,w.resetFire&&(s._fired=!1),k(a,n,s,d+1),s._masks=g.transforms.masks.slice(0),s._method===e.fn.drawImage&&s.visible){v=!0;break}if(v)break;h=d,s=C(g),f=g.event,y=f.type,g.drag.layer&&R(a,g,y),c=g.lastIntersected,null===c||s===c||!c._hovered||c._fired||g.drag.dragging||(g.lastIntersected=null,c._fired=!0,c._hovered=!1,X(a,g,c,"mouseout"),P(a,g)),s&&(s[y]||(y=z(y)),s._event&&s.intersects&&(g.lastIntersected=s,(s.mouseover||s.mouseout||s.cursors)&&!g.drag.dragging&&(s._hovered||s._fired||(s._fired=!0,s._hovered=!0,X(a,g,s,"mouseover"))),s._fired||(s._fired=!0,f.type=null,X(a,g,s,y)),!s.draggable||s.disableEvents||"mousedown"!==y&&"touchstart"!==y||(g.drag.layer=s,g.originalRedrawOnMousemove=g.redrawOnMousemove,g.redrawOnMousemove=!0))),null!==s||g.drag.dragging||P(a,g),h===o.length&&(g.intersecting.length=0,g.transforms=l($e),g.savedTransforms.length=0)}return m},e.fn.addLayer=function(e){var t,r,n,o=this;for(t=0;t<o.length;t+=1)r=i(o[t]),r&&(n=new a(e),n.layer=!0,Y(o[t],n,e));return o},De.props=["width","height","opacity","lineHeight"],De.propsObj={},e.fn.animateLayer=function(){function t(e,t,a){return function(){$(a),B(a),t.animating&&t.animated!==a||e.drawLayers(),a._animating=!1,t.animating=!1,t.animated=null,u[4]&&u[4].call(e[0],a),X(e,t,a,"animateend")}}function a(e,t,a){return function(r,n){var o,i,s,l=!1;"_"===n.prop[0]&&(l=!0,n.prop=n.prop.replace("_",""),a[n.prop]=a["_"+n.prop]),n.prop.indexOf(".")!==-1&&(o=n.prop.split("."),i=o[0],s=o[1],a[i]&&(a[i][s]=n.now)),a._pos!==n.pos&&(a._pos=n.pos,a._animating||t.animating||(a._animating=!0,t.animating=!0,t.animated=a),t.animating&&t.animated!==a||e.drawLayers()),u[5]&&u[5].call(e[0],r,n,a),X(e,t,a,"animate",n),l&&(n.prop="_"+n.prop)}}var r,n,o,s,l,c,d=this,u=Te.call(arguments,0);for("object"===xe(u[2])?(u.splice(2,0,u[2].duration||null),u.splice(3,0,u[3].easing||null),u.splice(4,0,u[4].complete||null),u.splice(5,0,u[5].step||null)):(void 0===u[2]?(u.splice(2,0,null),u.splice(3,0,null),u.splice(4,0,null)):be(u[2])&&(u.splice(2,0,null),u.splice(3,0,null)),void 0===u[3]?(u[3]=null,u.splice(4,0,null)):be(u[3])&&u.splice(3,0,null)),n=0;n<d.length;n+=1)r=e(d[n]),o=i(d[n]),o&&(s=p(d[n]),l=r.getLayer(u[0]),l&&l._method!==e.fn.draw&&(c=me({},u[1]),c=O(d[n],l,c),D(c,!0),D(l),l.style=De.propsObj,e(l).animate(c,{duration:u[2],easing:e.easing[u[3]]?u[3]:null,complete:t(r,s,l),step:a(r,s,l)}),X(r,s,l,"animatestart")));return d},e.fn.animateLayerGroup=function(t){var a,r,n,o,i=this,s=Te.call(arguments,0);for(r=0;r<i.length;r+=1)if(a=e(i[r]),n=a.getLayerGroup(t))for(o=0;o<n.length;o+=1)s[0]=n[o],a.animateLayer.apply(a,s);return i},e.fn.delayLayer=function(t,a){var r,n,o,i,s=this;for(a=a||0,n=0;n<s.length;n+=1)r=e(s[n]),o=p(s[n]),i=r.getLayer(t),i&&(e(i).delay(a),X(r,o,i,"delay"));return s},e.fn.delayLayerGroup=function(t,a){var r,n,o,i,s,l=this;for(a=a||0,n=0;n<l.length;n+=1)if(r=e(l[n]),o=r.getLayerGroup(t))for(s=0;s<o.length;s+=1)i=o[s],r.delayLayer(i,a);return l},e.fn.stopLayer=function(t,a){var r,n,o,i,s=this;for(n=0;n<s.length;n+=1)r=e(s[n]),o=p(s[n]),i=r.getLayer(t),i&&(e(i).stop(a),X(r,o,i,"stop"));return s},e.fn.stopLayerGroup=function(t,a){var r,n,o,i,s,l=this;for(n=0;n<l.length;n+=1)if(r=e(l[n]),o=r.getLayerGroup(t))for(s=0;s<o.length;s+=1)i=o[s],r.stopLayer(i,a);return l},W(["color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","outlineColor","strokeStyle","shadowColor"]),Xe.touchEvents={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},Xe.mouseEvents={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"},H(["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","touchstart","touchmove","touchend","pointerdown","pointermove","pointerup","contextmenu"]),e.event.fix=function(t){var a,r,n;if(t=Ae.call(e.event,t),r=t.originalEvent)if(n=r.changedTouches,void 0!==t.pageX&&void 0===t.offsetX)try{a=e(t.currentTarget).offset(),a&&(t.offsetX=t.pageX-a.left,t.offsetY=t.pageY-a.top)}catch(o){}else if(n)try{a=e(t.currentTarget).offset(),a&&(t.offsetX=n[0].pageX-a.left,t.offsetY=n[0].pageY-a.top)}catch(o){}return t},Xe.drawings={arc:"drawArc",bezier:"drawBezier",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",path:"drawPath",polygon:"drawPolygon",slice:"drawSlice",quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",vector:"drawVector",save:"saveCanvas",restore:"restoreCanvas",rotate:"rotateCanvas",scale:"scaleCanvas",translate:"translateCanvas"},e.fn.draw=function Me(e){var t,r,n=this,o=new a(e);if(Xe.drawings[o.type]&&"function"!==o.type)n[Xe.drawings[o.type]](e);else for(t=0;t<n.length;t+=1)r=i(n[t]),r&&(o=new a(e),Y(n[t],o,e,Me),o.visible&&o.fn&&o.fn.call(n[t],r,o));return n},e.fn.clearCanvas=function Ie(e){var t,r,n=this,o=new a(e);for(t=0;t<n.length;t+=1)r=i(n[t]),r&&(null===o.width||null===o.height?(r.save(),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,n[t].width,n[t].height),r.restore()):(Y(n[t],o,e,Ie),v(n[t],r,o,o.width,o.height),r.clearRect(o.x-o.width/2,o.y-o.height/2,o.width,o.height),f(r,o)));return n},e.fn.saveCanvas=function We(e){var t,r,n,o,s,l=this;for(t=0;t<l.length;t+=1)if(r=i(l[t]))for(o=p(l[t]),n=new a(e),Y(l[t],n,e,We),s=0;s<n.count;s+=1)c(r,o);return l},e.fn.restoreCanvas=function je(e){var t,r,n,o,s,l=this;for(t=0;t<l.length;t+=1)if(r=i(l[t]))for(o=p(l[t]),n=new a(e),Y(l[t],n,e,je),s=0;s<n.count;s+=1)d(r,o);return l},e.fn.rotateCanvas=function ze(e){var t,r,n,o,s=this;for(t=0;t<s.length;t+=1)r=i(s[t]),r&&(o=p(s[t]),n=new a(e),Y(s[t],n,e,ze),n.autosave&&c(r,o),N(r,n,o.transforms));return s},e.fn.scaleCanvas=function Ge(e){var t,r,n,o,s=this;for(t=0;t<s.length;t+=1)r=i(s[t]),r&&(o=p(s[t]),n=new a(e),Y(s[t],n,e,Ge),n.autosave&&c(r,o),F(r,n,o.transforms));return s},e.fn.translateCanvas=function He(e){var t,r,n,o,s=this;for(t=0;t<s.length;t+=1)r=i(s[t]),r&&(o=p(s[t]),n=new a(e),Y(s[t],n,e,He),n.autosave&&c(r,o),U(r,n,o.transforms));return s},e.fn.drawRect=function Ee(e){var t,r,n,o,s,l,c,d,u,g=this;for(t=0;t<g.length;t+=1)r=i(g[t]),r&&(n=new a(e),Y(g[t],n,e,Ee),n.visible&&(v(g[t],r,n,n.width,n.height),h(g[t],r,n),r.beginPath(),n.width&&n.height&&(o=n.x-n.width/2,s=n.y-n.height/2,d=ke(n.cornerRadius),d?(l=n.x+n.width/2,c=n.y+n.height/2,n.width<0&&(u=o,o=l,l=u),n.height<0&&(u=s,s=c,c=u),l-o-2*d<0&&(d=(l-o)/2),c-s-2*d<0&&(d=(c-s)/2),r.moveTo(o+d,s),r.lineTo(l-d,s),r.arc(l-d,s+d,d,3*_e/2,2*_e,!1),r.lineTo(l,c-d),r.arc(l-d,c-d,d,0,_e/2,!1),r.lineTo(o+d,c),r.arc(o+d,c-d,d,_e/2,_e,!1),r.lineTo(o,s+d),r.arc(o+d,s+d,d,_e,3*_e/2,!1),n.closed=!0):r.rect(o,s,n.width,n.height)),E(g[t],r,n),y(g[t],r,n)));return g},e.fn.drawArc=function Ne(e){var t,r,n,o=this;for(t=0;t<o.length;t+=1)r=i(o[t]),r&&(n=new a(e),Y(o[t],n,e,Ne),n.visible&&(v(o[t],r,n,2*n.radius),h(o[t],r,n),r.beginPath(),Q(o[t],r,n,n),E(o[t],r,n),y(o[t],r,n)));return o},e.fn.drawEllipse=function Fe(e){var t,r,n,o,s,l=this;for(t=0;t<l.length;t+=1)r=i(l[t]),r&&(n=new a(e),Y(l[t],n,e,Fe),n.visible&&(v(l[t],r,n,n.width,n.height),h(l[t],r,n),o=n.width*(4/3),s=n.height,r.beginPath(),r.moveTo(n.x,n.y-s/2),r.bezierCurveTo(n.x-o/2,n.y-s/2,n.x-o/2,n.y+s/2,n.x,n.y+s/2),r.bezierCurveTo(n.x+o/2,n.y+s/2,n.x+o/2,n.y-s/2,n.x,n.y-s/2),E(l[t],r,n),n.closed=!0,y(l[t],r,n)));return l},e.fn.drawPolygon=function Ue(e){var t,r,n,o,s,l,c,d,u,g,f=this;for(t=0;t<f.length;t+=1)if(r=i(f[t]),r&&(n=new a(e),Y(f[t],n,e,Ue),n.visible)){for(v(f[t],r,n,2*n.radius),h(f[t],r,n),s=2*_e/n.sides,l=s/2,o=l+_e/2,c=n.radius*Se(l),r.beginPath(),g=0;g<n.sides;g+=1)d=n.x+n.radius*Se(o),u=n.y+n.radius*Re(o),r.lineTo(d,u),n.concavity&&(d=n.x+(c+-c*n.concavity)*Se(o+l),u=n.y+(c+-c*n.concavity)*Re(o+l),r.lineTo(d,u)),o+=s;E(f[t],r,n),n.closed=!0,y(f[t],r,n)}return f},e.fn.drawSlice=function qe(e){var t,r,n,o,s,l,c=this;for(t=0;t<c.length;t+=1)r=i(c[t]),r&&(n=new a(e),Y(c[t],n,e,qe),n.visible&&(v(c[t],r,n,2*n.radius),h(c[t],r,n),n.start*=n._toRad,n.end*=n._toRad,n.start-=_e/2,n.end-=_e/2,n.start=q(n.start),n.end=q(n.end),n.end<n.start&&(n.end+=2*_e),o=(n.start+n.end)/2,s=n.radius*n.spread*Se(o),l=n.radius*n.spread*Re(o),n.x+=s,n.y+=l,r.beginPath(),r.arc(n.x,n.y,n.radius,n.start,n.end,n.ccw),r.lineTo(n.x,n.y),E(c[t],r,n),n.closed=!0,y(c[t],r,n)));return c},e.fn.drawLine=function Ve(e){var t,r,n,o=this;for(t=0;t<o.length;t+=1)r=i(o[t]),r&&(n=new a(e),Y(o[t],n,e,Ve),n.visible&&(v(o[t],r,n),h(o[t],r,n),r.beginPath(),te(o[t],r,n,n),E(o[t],r,n),y(o[t],r,n)));return o},e.fn.drawQuadratic=function Je(e){var t,r,n,o=this;for(t=0;t<o.length;t+=1)r=i(o[t]),r&&(n=new a(e),Y(o[t],n,e,Je),n.visible&&(v(o[t],r,n),h(o[t],r,n),r.beginPath(),ae(o[t],r,n,n),E(o[t],r,n),y(o[t],r,n)));return o},e.fn.drawBezier=function Qe(e){var t,r,n,o=this;for(t=0;t<o.length;t+=1)r=i(o[t]),r&&(n=new a(e),Y(o[t],n,e,Qe),n.visible&&(v(o[t],r,n),h(o[t],r,n),r.beginPath(),re(o[t],r,n,n),E(o[t],r,n),y(o[t],r,n)));return o},e.fn.drawVector=function Ke(e){var t,r,n,o=this;for(t=0;t<o.length;t+=1)r=i(o[t]),r&&(n=new a(e),Y(o[t],n,e,Ke),n.visible&&(v(o[t],r,n),h(o[t],r,n),r.beginPath(),ie(o[t],r,n,n),E(o[t],r,n),y(o[t],r,n)));return o},e.fn.drawPath=function Ze(e){var t,r,n,o,s,l=this;for(t=0;t<l.length;t+=1)if(r=i(l[t]),r&&(n=new a(e),Y(l[t],n,e,Ze),n.visible)){for(v(l[t],r,n),h(l[t],r,n),r.beginPath(),o=1;;){if(s=n["p"+o],void 0===s)break;s=new a(s),"line"===s.type?te(l[t],r,n,s):"quadratic"===s.type?ae(l[t],r,n,s):"bezier"===s.type?re(l[t],r,n,s):"vector"===s.type?ie(l[t],r,n,s):"arc"===s.type&&Q(l[t],r,n,s),o+=1}E(l[t],r,n),y(l[t],r,n)}return l},e.fn.drawText=function et(e){var t,r,n,o,s,l,c,d,u,g,y,p,m,w,x=this,b=500;for(t=0;t<x.length;t+=1)if(r=i(x[t]),r&&(n=new a(e),Y(x[t],n,e,et),n.visible)){if(r.textBaseline=n.baseline,r.textAlign=n.align,se(x[t],r,n),s=null!==n.maxWidth?ce(r,n):n.text.toString().split("\n"),le(x[t],r,n,s),o&&(o.width=n.width,o.height=n.height),v(x[t],r,n,n.width,n.height),h(x[t],r,n),m=n.x,"left"===n.align?n.respectAlign?n.x+=n.width/2:m-=n.width/2:"right"===n.align&&(n.respectAlign?n.x-=n.width/2:m+=n.width/2),n.radius)for(d=pe(n.fontSize),null===n.letterSpacing&&(n.letterSpacing=d/b),c=0;c<s.length;c+=1){for(r.save(),r.translate(n.x,n.y),l=s[c],n.flipArcText&&(g=l.split(""),g.reverse(),l=g.join("")),u=l.length,r.rotate(-(_e*n.letterSpacing*(u-1))/2),p=0;p<u;p+=1)y=l[p],0!==p&&r.rotate(_e*n.letterSpacing),r.save(),r.translate(0,-n.radius),n.flipArcText&&r.scale(-1,-1),r.fillText(y,0,0),"transparent"!==n.fillStyle&&(r.shadowColor="transparent"),0!==n.strokeWidth&&r.strokeText(y,0,0),r.restore();n.radius-=d,n.letterSpacing+=d/(2*b*_e),r.restore()}else for(c=0;c<s.length;c+=1)l=s[c],w=n.y+c*n.height/s.length-(s.length-1)*n.height/s.length/2,r.shadowColor=n.shadowColor,r.fillText(l,m,w),"transparent"!==n.fillStyle&&(r.shadowColor="transparent"),0!==n.strokeWidth&&r.strokeText(l,m,w);w=0,"top"===n.baseline?w+=n.height/2:"bottom"===n.baseline&&(w-=n.height/2),n._event&&(r.beginPath(),r.rect(n.x-n.width/2,n.y-n.height/2+w,n.width,n.height),E(x[t],r,n),r.closePath()),f(r,n)}return Ye.propCache=n,x},e.fn.measureText=function(e){var t,r,n,o=this;return r=o.getLayer(e),(!r||r&&!r._layer)&&(r=new a(e)),t=i(o[0]),t&&(se(o[0],t,r),n=null!==r.maxWidth?ce(t,r):r.text.split("\n"),le(o[0],t,r,n)),r},e.fn.drawImage=function tt(t){function r(e,t,a,r,n){null===r.width&&null===r.sWidth&&(r.width=r.sWidth=y.width),null===r.height&&null===r.sHeight&&(r.height=r.sHeight=y.height),n&&(n.width=r.width,n.height=r.height),null!==r.sWidth&&null!==r.sHeight&&null!==r.sx&&null!==r.sy?(null===r.width&&(r.width=r.sWidth),null===r.height&&(r.height=r.sHeight),r.cropFromCenter&&(r.sx+=r.sWidth/2,r.sy+=r.sHeight/2),r.sy-r.sHeight/2<0&&(r.sy=r.sHeight/2),r.sy+r.sHeight/2>y.height&&(r.sy=y.height-r.sHeight/2),r.sx-r.sWidth/2<0&&(r.sx=r.sWidth/2),r.sx+r.sWidth/2>y.width&&(r.sx=y.width-r.sWidth/2),v(e,t,r,r.width,r.height),h(e,t,r),t.drawImage(y,r.sx-r.sWidth/2,r.sy-r.sHeight/2,r.sWidth,r.sHeight,r.x-r.width/2,r.y-r.height/2,r.width,r.height)):(v(e,t,r,r.width,r.height),h(e,t,r),t.drawImage(y,r.x-r.width/2,r.y-r.height/2,r.width,r.height)),t.beginPath(),t.rect(r.x-r.width/2,r.y-r.height/2,r.width,r.height),E(e,t,r),t.closePath(),f(t,r),g(t,a,r)}function n(t,a,n,o,i){return function(){var s=e(t);r(t,a,n,o,i),o.layer?X(s,n,i,"load"):o.load&&o.load.call(s[0],i),o.layer&&(i._masks=n.transforms.masks.slice(0),o._next&&s.drawLayers({
clear:!1,resetFire:!0,index:o._next}))}}var o,s,l,c,d,u,y,m,w,x=this,b=Ye.imageCache;for(s=0;s<x.length;s+=1)o=x[s],l=i(x[s]),l&&(c=p(x[s]),d=new a(t),u=Y(x[s],d,t,tt),d.visible&&(w=d.source,m=w.getContext,w.src||m?y=w:w&&(b[w]&&b[w].complete?y=b[w]:(y=new he,w.match(/^data:/i)||(y.crossOrigin=d.crossOrigin),y.src=w,b[w]=y)),y&&(y.complete||m?n(o,l,c,d,u)():(y.onload=n(o,l,c,d,u),y.src=y.src))));return x},e.fn.createPattern=function(t){function r(){c=n.createPattern(s,o.repeat),o.load&&o.load.call(u[0],c)}var n,o,s,l,c,d,u=this;return n=i(u[0]),n?(o=new a(t),d=o.source,be(d)?(s=e("<canvas />")[0],s.width=o.width,s.height=o.height,l=i(s),d.call(s,l),r()):(l=d.getContext,d.src||l?s=d:(s=new he,d.match(/^data:/i)||(s.crossOrigin=o.crossOrigin),s.src=d),s.complete||l?r():(s.onload=r,s.src=s.src))):c=null,c},e.fn.createGradient=function(e){var t,r,n,o,s,l,c,d,u,h,g=this,f=[];if(r=new a(e),t=i(g[0])){for(r.x1=r.x1||0,r.y1=r.y1||0,r.x2=r.x2||0,r.y2=r.y2||0,n=null!==r.r1&&null!==r.r2?t.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2):t.createLinearGradient(r.x1,r.y1,r.x2,r.y2),c=1;void 0!==r["c"+c];c+=1)void 0!==r["s"+c]?f.push(r["s"+c]):f.push(null);for(o=f.length,null===f[0]&&(f[0]=0),null===f[o-1]&&(f[o-1]=1),c=0;c<o;c+=1){if(null!==f[c]){for(u=1,h=0,s=f[c],d=c+1;d<o;d+=1){if(null!==f[d]){l=f[d];break}u+=1}s>l&&(f[d]=f[c])}else null===f[c]&&(h+=1,f[c]=s+h*((l-s)/u));n.addColorStop(f[c],r["c"+(c+1)])}}else n=null;return n},e.fn.setPixels=function at(e){var t,r,n,o,s,l,c,d,u,h,g=this;for(r=0;r<g.length;r+=1)if(t=g[r],n=i(t),o=p(g[r]),n&&(s=new a(e),Y(t,s,e,at),v(g[r],n,s,s.width,s.height),null!==s.width&&null!==s.height||(s.width=t.width,s.height=t.height,s.x=s.width/2,s.y=s.height/2),0!==s.width&&0!==s.height)){if(c=n.getImageData((s.x-s.width/2)*o.pixelRatio,(s.y-s.height/2)*o.pixelRatio,s.width*o.pixelRatio,s.height*o.pixelRatio),d=c.data,h=d.length,s.each)for(u=0;u<h;u+=4)l={r:d[u],g:d[u+1],b:d[u+2],a:d[u+3]},s.each.call(t,l,s),d[u]=l.r,d[u+1]=l.g,d[u+2]=l.b,d[u+3]=l.a;n.putImageData(c,(s.x-s.width/2)*o.pixelRatio,(s.y-s.height/2)*o.pixelRatio),n.restore()}return g},e.fn.getCanvasImage=function(e,t){var a,r=this,n=null;return 0!==r.length&&(a=r[0],a.toDataURL&&(void 0===t&&(t=1),n=a.toDataURL("image/"+e,t))),n},e.fn.detectPixelRatio=function(e){var a,r,n,o,s,l,c,d,u,h=this;for(r=0;r<h.length;r+=1)a=h[r],n=i(a),u=p(h[r]),u.scaled||(o=t.devicePixelRatio||1,s=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1,l=o/s,1!==l&&(c=a.width,d=a.height,a.width=c*l,a.height=d*l,a.style.width=c+"px",a.style.height=d+"px",n.scale(l,l)),u.pixelRatio=l,u.scaled=!0,e&&e.call(a,l));return h},Be.clearCache=function(){var e;for(e in Ye)Object.prototype.hasOwnProperty.call(Ye,e)&&(Ye[e]={})},e.support.canvas=void 0!==e("<canvas />")[0].getContext,me(Be,{defaults:de,setGlobalProps:h,transformShape:v,detectEvents:E,closePath:y,setCanvasFont:se,measureText:le}),e.jCanvas=Be,e.jCanvasObject=a});var CenterX=300,CenterY=300;const bigRadius=250;var colorRayAndCircleByLabel="#48D1CC",colorLabel="#36c",radiusLabel=15,colorSelectLabel="Red",shadowLabelSize=10,shadowColor="white",$addTagLink=$('<a href="#" class="btn btn-primary btn-block">Добавить категорию</a>'),$newLinkLi=$("<div></div>").append($addTagLink);jQuery(document).ready(function(){var e=$("div.sectors");e.append($newLinkLi),e.data("index",e.find(":input").length),$addTagLink.on("click",function(t){t.preventDefault(),addTagForm(e,$newLinkLi)})});
//# sourceMappingURL=main.min.js.map
